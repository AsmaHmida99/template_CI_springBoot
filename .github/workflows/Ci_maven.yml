name: Pipeline for Spring Boot with Maven    
  
on:    
  push:  
    branches:  
        - main  
  pull_request:  
    branches:  
        - main  
  
jobs:    
  ci:    
    name: Continuous Integration   
    runs-on: ubuntu-latest    
        
    steps:    
      - name: Checkout source code    
        uses: actions/checkout@v4    
  
      - name: Set up JDK 17    
        uses: actions/setup-java@v4    
        with:    
          distribution: 'temurin'    
          java-version: 17    
  
      - name: Cache Maven dependencies    
        uses: actions/cache@v4    
        with:    
          path: ~/.m2    
          key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}    
          restore-keys: |    
            ${{ runner.os }}-maven    
  
      - name: Run tests with coverage    
        run: mvn clean verify jacoco:report -B    
  
      - name: Upload Jacoco coverage reports  
        uses: actions/upload-artifact@v4  
        if: always()  
        with:  
          name: jacoco-coverage-reports-${{ github.run_number }}  
          path: |  
            target/site/jacoco/  
            target/jacoco.exec  
          retention-days: 30  
  
      - name: Build application    
        run: mvn package -B -DskipTests